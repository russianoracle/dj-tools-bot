"""CI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è Telegram bot –º–æ–¥—É–ª—è.

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –†–ï–ê–õ–¨–ù–´–ï –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–æ—Ç–∞ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ Telegram API:
    - Keyboards (inline –∫–Ω–æ–ø–∫–∏)
    - Handlers (—Ñ—É–Ω–∫—Ü–∏–∏-—É—Ç–∏–ª–∏—Ç—ã)
    - Message formatting

–í—Å–µ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ë–ï–ó —Å–µ—Ç–∏ –∏ –ë–ï–ó Redis.
"""

import pytest
import os


@pytest.mark.unit
@pytest.mark.bot
class TestBotKeyboards:
    """–¢–µ—Å—Ç—ã inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä –±–æ—Ç–∞."""

    def test_main_keyboard_regular_user(self):
        """–¢–µ—Å—Ç –≥–ª–∞–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º get_main_keyboard –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            - 5 –∫–Ω–æ–ø–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            - –ö–Ω–æ–ø–∫–∏: Analyze URL, My Jobs, DJ Profile, Generate Set, Help

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞–Ω–∞

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
        """
        from app.modules.bot.keyboards.inline import get_main_keyboard

        keyboard = get_main_keyboard(is_admin=False)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ InlineKeyboardMarkup
        assert keyboard is not None, "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞"
        assert hasattr(keyboard, 'inline_keyboard'), "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ inline_keyboard"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫ (5 –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        buttons = keyboard.inline_keyboard
        assert len(buttons) == 5, \
            f"–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 –∫–Ω–æ–ø–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–µ–Ω–æ: {len(buttons)}"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
        button_texts = [btn[0].text for btn in buttons]
        expected_texts = [
            "üîó Analyze URL",
            "üìÅ My Jobs",
            "üë§ DJ Profile",
            "üéØ Generate Set",
            "‚ùì Help"
        ]

        for expected in expected_texts:
            assert expected in button_texts, \
                f"–ö–Ω–æ–ø–∫–∞ '{expected}' –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å"

    def test_main_keyboard_admin_user(self):
        """–¢–µ—Å—Ç –≥–ª–∞–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∞–¥–º–∏–Ω–∞.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É Admin Panel

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –í—ã–∑—ã–≤–∞–µ–º get_main_keyboard(is_admin=True)

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            6 –∫–Ω–æ–ø–æ–∫ –≤–º–µ—Å—Ç–æ 5

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –ê–¥–º–∏–Ω—Å–∫–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –ö–Ω–æ–ø–∫–∞ "Admin Panel" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
        """
        from app.modules.bot.keyboards.inline import get_main_keyboard

        keyboard = get_main_keyboard(is_admin=True)
        buttons = keyboard.inline_keyboard

        assert len(buttons) == 6, \
            f"–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 6 –∫–Ω–æ–ø–æ–∫ –¥–ª—è –∞–¥–º–∏–Ω–∞, –ø–æ–ª—É—á–µ–Ω–æ: {len(buttons)}"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–¥–º–∏–Ω—Å–∫–æ–π –∫–Ω–æ–ø–∫–∏
        button_texts = [btn[0].text for btn in buttons]
        assert "‚öôÔ∏è Admin Panel" in button_texts, \
            "–ê–¥–º–∏–Ω—Å–∫–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å"

    def test_back_keyboard(self):
        """–¢–µ—Å—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã "–ù–∞–∑–∞–¥".

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –í—ã–∑—ã–≤–∞–µ–º get_back_keyboard()

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "Back to Menu"

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Å callback "main_menu"
        """
        from app.modules.bot.keyboards.inline import get_back_keyboard

        keyboard = get_back_keyboard()
        buttons = keyboard.inline_keyboard

        assert len(buttons) == 1, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞"
        assert buttons[0][0].text == "‚óÄÔ∏è Back to Menu", \
            "–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'Back to Menu'"
        assert buttons[0][0].callback_data == "main_menu", \
            "Callback –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'main_menu'"

    def test_jobs_keyboard(self):
        """–¢–µ—Å—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–ø–∏—Å–∫–∞ jobs.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ jobs —Å–æ–¥–µ—Ä–∂–∏—Ç job buttons + Refresh + Back

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ job IDs –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            N job –∫–Ω–æ–ø–æ–∫ + 2 —Å–ª—É–∂–µ–±–Ω—ã–µ (Refresh, Back)

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –í—Å–µ –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫ = len(jobs) + 2
        """
        from app.modules.bot.keyboards.inline import get_jobs_keyboard

        job_ids = ["job_123", "job_456", "job_789"]
        keyboard = get_jobs_keyboard(job_ids)
        buttons = keyboard.inline_keyboard

        # 3 job –∫–Ω–æ–ø–∫–∏ + Refresh + Back = 5
        assert len(buttons) == 5, \
            f"–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 –∫–Ω–æ–ø–æ–∫ (3 jobs + Refresh + Back), –ø–æ–ª—É—á–µ–Ω–æ: {len(buttons)}"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º Refresh –∫–Ω–æ–ø–∫—É
        assert buttons[-2][0].text == "üîÑ Refresh", \
            "–ü—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å Refresh"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º Back –∫–Ω–æ–ø–∫—É
        assert buttons[-1][0].text == "‚óÄÔ∏è Back", \
            "–ü–æ—Å–ª–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å Back"


@pytest.mark.unit
@pytest.mark.bot
class TestBotHandlers:
    """–¢–µ—Å—Ç—ã handler —Ñ—É–Ω–∫—Ü–∏–π."""

    def test_is_admin_function(self):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ admin –ø—Ä–∞–≤.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –§—É–Ω–∫—Ü–∏—è is_admin –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∞

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º is_admin –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Å —Ä–∞–∑–Ω—ã–º–∏ user_id

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            –¢–æ–ª—å–∫–æ ADMIN_USER_ID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            is_admin(admin_id) = True, –æ—Å—Ç–∞–ª—å–Ω—ã–µ = False
        """
        from app.modules.bot.handlers.start import is_admin

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        original_admin = os.getenv("ADMIN_USER_ID")

        try:
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
            os.environ["ADMIN_USER_ID"] = "123456789"

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∞
            assert is_admin(123456789) is True, \
                "ADMIN_USER_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–æ–º"

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ-–∞–¥–º–∏–Ω–∞
            assert is_admin(987654321) is False, \
                "–î—Ä—É–≥–æ–π user_id –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–æ–º"

        finally:
            # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            if original_admin:
                os.environ["ADMIN_USER_ID"] = original_admin
            else:
                os.environ.pop("ADMIN_USER_ID", None)

    def test_get_main_text(self):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –§—É–Ω–∫—Ü–∏—è get_main_text –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –¢–µ–∫—Å—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
        """
        from app.modules.bot.handlers.start import get_main_text

        text = get_main_text()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        assert "DJ Set Analyzer" in text, \
            "–¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω
        assert "üü®" in text and "Yellow" in text, \
            "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ Yellow –∑–æ–Ω—ã"
        assert "üü©" in text and "Green" in text, \
            "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ Green –∑–æ–Ω—ã"
        assert "üü™" in text and "Purple" in text, \
            "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ Purple –∑–æ–Ω—ã"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        assert "<b>" in text and "</b>" in text, \
            "–¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å HTML —Ç–µ–≥–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"


@pytest.mark.integration
@pytest.mark.bot
class TestBotSchemas:
    """–¢–µ—Å—Ç—ã —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞."""

    def test_job_schema_exists(self):
        """–¢–µ—Å—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è Job schema.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            Job schema –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ app.modules.bot.schemas.job

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            –ò–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            Schema –¥–æ—Å—Ç—É–ø–Ω–∞

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –ù–µ—Ç ImportError
        """
        # –ü—ã—Ç–∞–µ–º—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å job schema
        try:
            from app.modules.bot.schemas import job
            assert job is not None, "Job schema –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω"
        except ImportError as e:
            pytest.fail(f"Job schema –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: {e}")


@pytest.mark.unit
class TestBotLogic:
    """–¢–µ—Å—Ç—ã –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Telegram)."""

    def test_url_validation_logic(self):
        """–¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ URL.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è URL (http/https)

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            Regex –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∏–º–ø–æ—Ä—Ç–∞ app/

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            HTTP/HTTPS URL –≤–∞–ª–∏–¥–Ω—ã

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è URL
        """
        import re
        url_pattern = re.compile(r'^https?://')

        def is_valid_url(url: str) -> bool:
            return bool(url_pattern.match(url))

        # –í–∞–ª–∏–¥–Ω—ã–µ
        assert is_valid_url("https://youtube.com/watch?v=test")
        assert is_valid_url("http://soundcloud.com/track")

        # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ
        assert not is_valid_url("ftp://file.com")
        assert not is_valid_url("just text")
        assert not is_valid_url("")

    def test_file_size_limit(self):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –õ–∏–º–∏—Ç 500MB –¥–ª—è —Ñ–∞–π–ª–æ–≤

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            –§–∞–π–ª—ã > 500MB –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –õ–∏–º–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
        """
        MAX_SIZE_MB = 500
        MAX_SIZE_BYTES = MAX_SIZE_MB * 1024 * 1024

        def is_size_valid(size_bytes: int) -> bool:
            return size_bytes <= MAX_SIZE_BYTES

        # –í–∞–ª–∏–¥–Ω—ã–µ
        assert is_size_valid(100 * 1024 * 1024)  # 100MB
        assert is_size_valid(500 * 1024 * 1024)  # 500MB

        # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ
        assert not is_size_valid(600 * 1024 * 1024)  # 600MB
        assert not is_size_valid(1024 * 1024 * 1024)  # 1GB

    def test_duration_formatting(self):
        """–¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.

        –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú:
            –°–µ–∫—É–Ω–¥—ã ‚Üí MM:SS –∏–ª–∏ HH:MM:SS

        –ö–ê–ö –ü–†–û–í–ï–†–Ø–ï–ú:
            –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

        –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
            –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

        –†–ï–ó–£–õ–¨–¢–ê–¢:
            –í—Ä–µ–º—è –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ

        –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–®–ù–û–°–¢–ò:
            –í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
        """
        def format_duration(seconds: int) -> str:
            hours = seconds // 3600
            minutes = (seconds % 3600) // 60
            secs = seconds % 60

            if hours > 0:
                return f"{hours}:{minutes:02d}:{secs:02d}"
            else:
                return f"{minutes}:{secs:02d}"

        assert format_duration(65) == "1:05"
        assert format_duration(3661) == "1:01:01"
        assert format_duration(30) == "0:30"