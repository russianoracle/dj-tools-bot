# –£–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. –ö—ç—à —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —Ñ–ª–∞–≥ `--checkpoint-dir`
2. –ö—ç—à –ù–ï –æ–±–Ω–æ–≤–ª—è–ª—Å—è - –µ—Å–ª–∏ `features.pkl` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª, –Ω–æ–≤—ã–π –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è
3. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (10 ‚Üí 51) —Å—Ç–∞—Ä—ã–π –∫—ç—à –æ—Å—Ç–∞–≤–∞–ª—Å—è –∏ –º–æ–≥ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –æ–±—É—á–µ–Ω–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫—ç—à (—Ç—Ä–∞—Ç–∏–ª–∏ 40+ –º–∏–Ω—É—Ç –Ω–∞ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—é)
- –°—Ç–∞—Ä—ã–π –∫—ç—à —Å 10 –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –º–æ–≥ –æ—Å—Ç–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ 51 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

## –†–µ—à–µ–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ checkpoint_manager

**–§–∞–π–ª:** `src/training/zone_trainer.py:495-498`

```python
# Setup checkpoints - ALWAYS create checkpoint manager for feature caching
if checkpoint_dir is None:
    # Use default checkpoint directory for feature caching
    checkpoint_dir = 'models/checkpoints'
checkpoint_manager = CheckpointManager(checkpoint_dir)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö—ç—à —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–°–ï–ì–î–ê, –¥–∞–∂–µ –±–µ–∑ —Ñ–ª–∞–≥–∞ `--checkpoint-dir`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `models/checkpoints`

### 2. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞

**–§–∞–π–ª:** `src/training/checkpoint_manager.py:66-75`

```python
# Save features - ALWAYS overwrite to keep cache up-to-date
if features_df is not None:
    features_path = self.checkpoint_dir / "features.pkl"
    # Remove old cache if exists
    if features_path.exists():
        features_path.unlink()
        logger.info(f"Removed old features cache: {features_path}")
    # Save new cache
    features_df.to_pickle(str(features_path))
    logger.info(f"Saved features cache to {features_path}")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ä—ã–π –∫—ç—à –£–î–ê–õ–Ø–ï–¢–°–Ø –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
- –ù–æ–≤—ã–π –∫—ç—à –í–°–ï–ì–î–ê —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- –ü—Ä–∏–∑–Ω–∞–∫–∏ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫—ç—à–µ–º

**–§–∞–π–ª:** `src/training/zone_trainer.py:253-262`

```python
# Always save features cache for faster re-runs
if checkpoint_manager:
    self._log(log_callback, "INFO", f"üíæ Saving features cache to {checkpoint_manager.checkpoint_dir}/features.pkl")
    checkpoint_manager.save_checkpoint(
        model=None,
        epoch=0,
        metrics={},
        algorithm='features',
        features_df=features_df
    )
    self._log(log_callback, "INFO", f"‚úì Features cache saved successfully")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, –∫–æ–≥–¥–∞ –∫—ç—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ü–æ–Ω—è—Ç–Ω–æ, –∫—É–¥–∞ –∏–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–∞–π–ª

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤

**–ë–µ–∑ –∫—ç—à–∞:**
- –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è 415 —Ç—Ä–µ–∫–æ–≤ √ó 51 –ø—Ä–∏–∑–Ω–∞–∫ = ~40 –º–∏–Ω—É—Ç

**–° –∫—ç—à–µ–º:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ `features.pkl` = ~1 —Å–µ–∫—É–Ω–¥–∞
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2400 —Ä–∞–∑!**

### 2. –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å—Ç–∞—Ä—ã–π –∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- –ù–æ–≤—ã–π –∫—ç—à —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
- –ù–µ—Ç —Ä–∏—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

### 3. –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–†–∞–Ω—å—à–µ:**
```bash
# –ù—É–∂–Ω–æ –±—ã–ª–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å --checkpoint-dir
python scripts/train_zone_classifier.py data.tsv --checkpoint-dir models/checkpoints
```

**–¢–µ–ø–µ—Ä—å:**
```bash
# –ö—ç—à —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
python scripts/train_zone_classifier.py data.tsv
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞

```
models/checkpoints/
‚îú‚îÄ‚îÄ features.pkl                          # –ö—ç—à –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–í–°–ï–ì–î–ê –∞–∫—Ç—É–∞–ª—å–Ω—ã–π)
‚îú‚îÄ‚îÄ checkpoint_metadata.json              # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ checkpoint'–æ–≤
‚îî‚îÄ‚îÄ xgboost_epoch_12_20251123_135348.pkl # Checkpoint –º–æ–¥–µ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### features.pkl

**–§–æ—Ä–º–∞—Ç:** pandas DataFrame
**–°—Ç–æ–ª–±—Ü—ã:**
- `audio_path`: –ø—É—Ç—å –∫ –∞—É–¥–∏–æ —Ñ–∞–π–ª—É
- `zone_label`: –∑–æ–Ω–∞ (yellow/green/purple)
- `features_list`: –æ–±—ä–µ–∫—Ç ZoneFeatures –∏–ª–∏ FastZoneFeatures

**–†–∞–∑–º–µ—Ä:** ~2-5 KB (–¥–ª—è 415 —Ç—Ä–µ–∫–æ–≤ —Å 51 –ø—Ä–∏–∑–Ω–∞–∫–æ–º)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞: `check_cache.py`

```bash
python check_cache.py
```

**–í—ã–≤–æ–¥:**
```
‚úì DataFrame with 415 rows
Columns: ['audio_path', 'zone_label', 'features_list']
‚úì Feature vector shape: (51,)
‚úì Number of features: 51
‚úì NEW CACHE: 51 features (ZoneFeatureExtractor with DJ features)
```

## –ú–∏–≥—Ä–∞—Ü–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:

1. **–£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫—ç—à:**
   ```bash
   rm -f models/checkpoints/features.pkl
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ:**
   ```bash
   python scripts/train_zone_classifier.py tests/test_data_prepared.tsv
   ```

3. **–ù–æ–≤—ã–π –∫—ç—à —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–ù–æ–≤—ã–π –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –∫—ç—à –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ
- –°–æ–∑–¥–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—ç—à —Å 51 –ø—Ä–∏–∑–Ω–∞–∫–æ–º
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## –ò—Ç–æ–≥

‚úÖ **–ö—ç—à —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–°–ï–ì–î–ê**
‚úÖ **–ö—ç—à –û–ë–ù–û–í–õ–Ø–ï–¢–°–Ø –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ**
‚úÖ **–ù–µ—Ç –∫—É—á–∏ —Ñ–∞–π–ª–æ–≤** - –æ–¥–∏–Ω —Ñ–∞–π–ª `features.pkl`
‚úÖ **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ –≤ 2400 —Ä–∞–∑**
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞ –∫ –Ω–æ–≤–æ–º—É
