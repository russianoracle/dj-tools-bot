[pytest]
# Pytest configuration for mood-classifier

# Минимальная версия pytest
minversion = 7.0

# Где искать тесты
testpaths = tests

# Паттерны файлов тестов
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Настройки вывода
console_output_style = progress
addopts =
    -ra
    --strict-markers
    --strict-config
    --showlocals

# Маркеры для организации тестов
markers =
    # Категории тестов по скорости/зависимостям
    unit: Быстрые unit-тесты без внешних зависимостей (<1 сек)
    integration: Интеграционные тесты с реальными сервисами (Redis, файловая система)
    e2e: End-to-end тесты полного flow (медленные, требуют сеть)

    # Зависимости от внешних ресурсов
    requires_redis: Требует запущенного Redis сервиса
    requires_network: Требует доступа к сети (загрузка аудио)
    requires_audio: Требует реальных аудио файлов
    slow: Медленные тесты (>5 секунд)

    # Docker container
    container: Тесты runtime зависимостей внутри Docker контейнера

    # Компоненты приложения
    bot: Тесты компонентов Telegram бота
    cache: Тесты кеш-слоя
    pipeline: Тесты pipeline с реальными audio файлами
    analysis: Тесты audio analysis pipeline
    profiling: Тесты DJ profiling сервисов
    generation: Тесты set generation pipeline

    # Качество кода
    critical: Критичные тесты (100% coverage обязателен)
    invariant: Архитектурные инварианты
    regression: Regression тесты с golden baselines

    # Async тесты
    asyncio: Асинхронные тесты (используется pytest-asyncio)

# Настройки async тестов
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Игнорировать предупреждения от внешних библиотек
filterwarnings =
    ignore::DeprecationWarning:librosa.*
    ignore::DeprecationWarning:numba.*
    ignore::UserWarning:torch.*

# Настройки coverage (если используется pytest-cov)
[coverage:run]
source = app
omit =
    */tests/*
    */conftest.py
    */__pycache__/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False